<!DOCTYPE html>
<html>
<head>
    <title>ë‰´ìŠ¤ë ˆí„° ê²°ê³¼</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .category { margin-bottom: 30px; }
        .category-header { background-color: #f5f5f5; padding: 10px; border-radius: 5px; margin-bottom: 15px; }
        .item { margin-bottom: 15px; border: 1px solid #ddd; padding: 15px; border-radius: 5px; position: relative; }
        .title { font-weight: bold; font-size: 18px; margin-bottom: 10px; }
        .summary { color: #555; margin-bottom: 10px; line-height: 1.5; }
        .link { display: inline-block; color: #1a0dab; text-decoration: none; padding: 5px 10px; border: 1px solid #1a0dab; border-radius: 4px; margin-right: 10px; }
        .link:hover { background-color: #1a0dab; color: white; }
        h1, h2 { color: #333; }
        h2 { padding-bottom: 10px; border-bottom: 1px solid #eee; }
        .back-button { margin-top: 20px; display: inline-block; padding: 10px 15px; background-color: #4CAF50; color: white; text-decoration: none; border-radius: 4px; }
        .back-button:hover { background-color: #45a049; }
        .no-items { font-style: italic; color: #777; }
        .copy-button { padding: 5px 10px; background-color: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px; }
        .copy-button:hover { background-color: #5a6268; }
        .copy-all-button { margin-left: 10px; padding: 5px 15px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .copy-all-button:hover { background-color: #0069d9; }
        .button-group { margin-top: 15px; display: flex; }
        .copy-success { position: absolute; top: 10px; right: 10px; background-color: rgba(40, 167, 69, 0.9); color: white; padding: 5px 10px; border-radius: 4px; display: none; }
        .hidden-content { position: absolute; left: -9999px; height: 1px; width: 1px; overflow: hidden; }
        .options { margin-bottom: 15px; }
        /* ì „ì²´ ë‰´ìŠ¤ë ˆí„° ì„¹ì…˜ì„ ìœ„í•œ ìŠ¤íƒ€ì¼ */
        .newsletter-container { 
            border: 1px solid #ddd; 
            padding: 20px; 
            margin-bottom: 20px; 
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .copy-all-success {
            display: none;
            padding: 10px;
            background-color: rgba(40, 167, 69, 0.9);
            color: white;
            border-radius: 4px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <h1>ë‰´ìŠ¤ë ˆí„° ê²°ê³¼</h1>
    
    <div class="options">
        <strong>ì „ì²´ ë‰´ìŠ¤ë ˆí„° ë³µì‚¬:</strong>
        <button id="copy-all-button" class="copy-all-button">ì „ì²´ ë‚´ìš© ë³µì‚¬</button>
        <span id="copy-all-success" class="copy-all-success">ë³µì‚¬ ì™„ë£Œ!</span>
    </div>
    
<div class="hidden-content" id="full-newsletter">
        <h1>ğŸ“° ì£¼ê°„ ë‰´ìŠ¤ë ˆí„°</h1>
        
        <!-- ë‰´ìŠ¤ ì„¹ì…˜ -->
        {% if summaries|selectattr('category', 'equalto', 'News')|list %}
        <h2>ğŸ“£ News</h2>
        {% for item in summaries if item.category == 'News' %}
        <div>
            <h3>{{ item.title }}</h3>
            <p>{{ item.summary }}</p>
            <p><a href="{{ item.link }}">ë°”ë¡œê°€ê¸°</a></p>
        </div>
        {% endfor %}
        {% endif %}
        
        <!-- Knowledge ì„¹ì…˜ -->
        {% if summaries|selectattr('category', 'equalto', 'Knowledge')|list %}
        <h2>ğŸ“š Knowledge</h2>
        {% for item in summaries if item.category == 'Knowledge' %}
        <div>
            <h3>{{ item.title }}</h3>
            <p>{{ item.summary }}</p>
            <p><a href="{{ item.link }}">ë°”ë¡œê°€ê¸°</a></p>
        </div>
        {% endfor %}
        {% endif %}
        
        <!-- Guide ì„¹ì…˜ -->
        {% if summaries|selectattr('category', 'equalto', 'Guide')|list %}
        <h2>ğŸ“ Guide</h2>
        {% for item in summaries if item.category == 'Guide' %}
        <div>
            <h3>{{ item.title }}</h3>
            <p>{{ item.summary }}</p>
            <p><a href="{{ item.link }}">ë°”ë¡œê°€ê¸°</a></p>
        </div>
        {% endfor %}
        {% endif %}
    </div>

    <div class="category">
        <h2 class="category-header">News</h2>
        {% for item in summaries if item.category == 'News' %}
        <div class="item" id="item-news-{{ loop.index }}">
            <div class="title">{{ item.title }}</div>
            <div class="summary">{{ item.summary }}</div>
            <div class="button-group">
                <a href="{{ item.link }}" class="link" target="_blank">ë°”ë¡œê°€ê¸°</a>
                <button class="copy-button" onclick="copyItem('news-{{ loop.index }}')">í•­ëª© ë³µì‚¬</button>
            </div>
            <div class="copy-success" id="copy-success-news-{{ loop.index }}">ë³µì‚¬ ì™„ë£Œ!</div>
            
            <!-- ë³µì‚¬ìš© ìˆ¨ê²¨ì§„ ì½˜í…ì¸  -->
            <div class="hidden-content" id="copy-content-news-{{ loop.index }}">
                <h3>{{ item.title }}</h3>
                <p>{{ item.summary }}</p>
                <p><a href="{{ item.link }}">ë°”ë¡œê°€ê¸°</a></p>
            </div>
        </div>
        {% else %}
        <p class="no-items">News í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        {% endfor %}
    </div>

    <div class="category">
        <h2 class="category-header">Knowledge</h2>
        {% for item in summaries if item.category == 'Knowledge' %}
        <div class="item" id="item-knowledge-{{ loop.index }}">
            <div class="title">{{ item.title }}</div>
            <div class="summary">{{ item.summary }}</div>
            <div class="button-group">
                <a href="{{ item.link }}" class="link" target="_blank">ë°”ë¡œê°€ê¸°</a>
                <button class="copy-button" onclick="copyItem('knowledge-{{ loop.index }}')">í•­ëª© ë³µì‚¬</button>
            </div>
            <div class="copy-success" id="copy-success-knowledge-{{ loop.index }}">ë³µì‚¬ ì™„ë£Œ!</div>
            
            <!-- ë³µì‚¬ìš© ìˆ¨ê²¨ì§„ ì½˜í…ì¸  -->
            <div class="hidden-content" id="copy-content-knowledge-{{ loop.index }}">
                <h3>{{ item.title }}</h3>
                <p>{{ item.summary }}</p>
                <p><a href="{{ item.link }}">ë°”ë¡œê°€ê¸°</a></p>
            </div>
        </div>
        {% else %}
        <p class="no-items">Knowledge í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        {% endfor %}
    </div>

    <div class="category">
        <h2 class="category-header">Guide</h2>
        {% for item in summaries if item.category == 'Guide' %}
        <div class="item" id="item-guide-{{ loop.index }}">
            <div class="title">{{ item.title }}</div>
            <div class="summary">{{ item.summary }}</div>
            <div class="button-group">
                <a href="{{ item.link }}" class="link" target="_blank">ë°”ë¡œê°€ê¸°</a>
                <button class="copy-button" onclick="copyItem('guide-{{ loop.index }}')">í•­ëª© ë³µì‚¬</button>
            </div>
            <div class="copy-success" id="copy-success-guide-{{ loop.index }}">ë³µì‚¬ ì™„ë£Œ!</div>
            
            <!-- ë³µì‚¬ìš© ìˆ¨ê²¨ì§„ ì½˜í…ì¸  -->
            <div class="hidden-content" id="copy-content-guide-{{ loop.index }}">
                <h3>{{ item.title }}</h3>
                <p>{{ item.summary }}</p>
                <p><a href="{{ item.link }}">ë°”ë¡œê°€ê¸°</a></p>
            </div>
        </div>
        {% else %}
        <p class="no-items">Guide í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        {% endfor %}
    </div>

    <a href="/" class="back-button">ë‹¤ì‹œ ì‘ì„±í•˜ê¸°</a>

    <script>
        // ë¸Œë¼ìš°ì € ê¸°ëŠ¥ íƒì§€
        const hasClipboardAPI = navigator.clipboard !== undefined;
        const hasClipboardWriteAPI = hasClipboardAPI && typeof navigator.clipboard.write === 'function';
        const hasClipboardItemAPI = window.ClipboardItem !== undefined;
        
        // ì„œì‹ìˆëŠ” HTML ë³µì‚¬ í•¨ìˆ˜
        async function copyRichText(html, text, successCallback, errorCallback) {
            // ìµœì‹  ClipboardItem API ì§€ì› í™•ì¸
            if (hasClipboardWriteAPI && hasClipboardItemAPI) {
                try {
                    const clipboardItem = new ClipboardItem({
                        'text/html': new Blob([html], { type: 'text/html' }),
                        'text/plain': new Blob([text], { type: 'text/plain' })
                    });
                    
                    await navigator.clipboard.write([clipboardItem]);
                    successCallback();
                    return true;
                } catch (err) {
                    console.warn('Clipboard HTML ë³µì‚¬ ì‹¤íŒ¨:', err);
                    // ì˜¤ë¥˜ ë°œìƒ ì‹œ ë‹¤ìŒ ë°©ë²• ì‹œë„
                }
            }
            
            // ì¼ë°˜ í…ìŠ¤íŠ¸ ë³µì‚¬ ì‹œë„
            if (hasClipboardAPI) {
                try {
                    await navigator.clipboard.writeText(text);
                    successCallback();
                    return true;
                } catch (err) {
                    console.warn('Clipboard í…ìŠ¤íŠ¸ ë³µì‚¬ ì‹¤íŒ¨:', err);
                }
            }
            
            // document.execCommand ë°©ì‹ ì‹œë„
            try {
                // ì„ì‹œ ì»¨í…Œì´ë„ˆ ìƒì„±
                const tempContainer = document.createElement('div');
                tempContainer.innerHTML = html;
                tempContainer.style.position = 'fixed';
                tempContainer.style.top = '0';
                tempContainer.style.opacity = '0';
                document.body.appendChild(tempContainer);
                
                // ì„ íƒ ë° ë³µì‚¬
                const range = document.createRange();
                range.selectNodeContents(tempContainer);
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);
                
                const successful = document.execCommand('copy');
                document.body.removeChild(tempContainer);
                
                if (successful) {
                    successCallback();
                    return true;
                }
            } catch (err) {
                console.warn('execCommand ë³µì‚¬ ì‹¤íŒ¨:', err);
            }
            
            // ëª¨ë“  ë°©ë²• ì‹¤íŒ¨ ì‹œ
            errorCallback();
            return false;
        }
        
        // ê°œë³„ í•­ëª© ë³µì‚¬ í•¨ìˆ˜
        function copyItem(id) {
            const content = document.getElementById(`copy-content-${id}`);
            const successNotice = document.getElementById(`copy-success-${id}`);
            
            copyRichText(
                content.innerHTML,
                content.innerText,
                () => {
                    // ë³µì‚¬ ì„±ê³µ ì•Œë¦¼ í‘œì‹œ
                    successNotice.style.display = 'block';
                    setTimeout(() => {
                        successNotice.style.display = 'none';
                    }, 2000);
                },
                () => {
                    // ëª¨ë“  ë³µì‚¬ ë°©ë²•ì´ ì‹¤íŒ¨í•œ ê²½ìš°
                    alert('ìë™ ë³µì‚¬ê°€ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í•´ë‹¹ ë‚´ìš©ì„ ì§ì ‘ ì„ íƒí•˜ì—¬ ë³µì‚¬í•´ì£¼ì„¸ìš”.');
                    
                    // ì‚¬ìš©ìê°€ ì§ì ‘ ë³µì‚¬í•  ìˆ˜ ìˆë„ë¡ ë‚´ìš© í‘œì‹œ
                    const tempDisplay = document.createElement('div');
                    tempDisplay.innerHTML = content.innerHTML;
                    tempDisplay.style.padding = '15px';
                    tempDisplay.style.border = '1px solid #ccc';
                    tempDisplay.style.backgroundColor = '#f9f9f9';
                    tempDisplay.style.margin = '10px 0';
                    tempDisplay.style.borderRadius = '5px';
                    
                    // ì›ë³¸ í•­ëª© ì•„ë˜ì— í‘œì‹œ
                    const item = document.getElementById(`item-${id}`);
                    item.appendChild(tempDisplay);
                    
                    // í‘œì‹œëœ ë‚´ìš© ì„ íƒ
                    const range = document.createRange();
                    range.selectNodeContents(tempDisplay);
                    const selection = window.getSelection();
                    selection.removeAllRanges();
                    selection.addRange(range);
                }
            );
        }
        
        // ì „ì²´ ë‰´ìŠ¤ë ˆí„° ë³µì‚¬ í•¨ìˆ˜
        document.getElementById('copy-all-button').addEventListener('click', function() {
            const fullNewsletter = document.getElementById('full-newsletter');
            const successNotice = document.getElementById('copy-all-success');
            
            copyRichText(
                fullNewsletter.innerHTML,
                fullNewsletter.innerText,
                () => {
                    // ë³µì‚¬ ì„±ê³µ ì•Œë¦¼ í‘œì‹œ
                    successNotice.style.display = 'block';
                    setTimeout(() => {
                        successNotice.style.display = 'none';
                    }, 2000);
                },
                () => {
                    // ëª¨ë“  ë³µì‚¬ ë°©ë²•ì´ ì‹¤íŒ¨í•œ ê²½ìš°
                    alert('ìë™ ë³µì‚¬ê°€ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì•„ë˜ ë‚´ìš©ì„ ì§ì ‘ ì„ íƒí•˜ì—¬ ë³µì‚¬í•´ì£¼ì„¸ìš”.');
                    
                    // ì‚¬ìš©ìê°€ ì§ì ‘ ë³µì‚¬í•  ìˆ˜ ìˆë„ë¡ ë‚´ìš© í‘œì‹œ
                    const newsletterContainer = document.createElement('div');
                    newsletterContainer.className = 'newsletter-container';
                    newsletterContainer.innerHTML = fullNewsletter.innerHTML;
                    
                    // ë²„íŠ¼ ì•„ë˜ì— í‘œì‹œ
                    const optionsDiv = document.querySelector('.options');
                    optionsDiv.parentNode.insertBefore(newsletterContainer, optionsDiv.nextSibling);
                    
                    // í‘œì‹œëœ ë‚´ìš© ì„ íƒ
                    const range = document.createRange();
                    range.selectNodeContents(newsletterContainer);
                    const selection = window.getSelection();
                    selection.removeAllRanges();
                    selection.addRange(range);
                }
            );
        });
    </script>
</body>
</html>